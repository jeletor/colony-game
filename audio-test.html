<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Colony Platformer ‚Äî Audio Test</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #1a1a2e;
    color: #e0e0e8;
    font-family: 'Courier New', monospace;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 20px;
  }
  h1 { font-size: 1.8rem; margin-bottom: 8px; color: #7b68ee; }
  .subtitle { color: #888; font-size: 0.85rem; margin-bottom: 32px; }
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 12px;
    max-width: 720px;
    width: 100%;
    margin-bottom: 32px;
  }
  button {
    background: #2a2a3e;
    border: 2px solid #3a3a5e;
    color: #e0e0e8;
    padding: 20px 16px;
    border-radius: 12px;
    font-family: inherit;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.15s;
    text-align: center;
  }
  button:hover { border-color: #7b68ee; background: #32325a; transform: translateY(-2px); }
  button:active { transform: translateY(0); background: #3a3a6e; }
  .emoji { font-size: 1.8rem; display: block; margin-bottom: 8px; }
  .key { color: #666; font-size: 0.75rem; margin-top: 6px; }
  .music-btn { grid-column: span 2; background: #1e3a1e; border-color: #2e5a2e; }
  .music-btn:hover { background: #2a4a2a; border-color: #4ade80; }
  .music-btn.playing { background: #2a4a2a; border-color: #4ade80; box-shadow: 0 0 20px rgba(74,222,128,0.2); }
  .controls { display: flex; gap: 16px; align-items: center; margin-bottom: 24px; }
  .controls label { font-size: 0.8rem; color: #888; }
  input[type="range"] {
    -webkit-appearance: none;
    background: #2a2a3e;
    height: 6px;
    border-radius: 3px;
    outline: none;
  }
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #7b68ee;
    cursor: pointer;
  }
  .hint { color: #555; font-size: 0.8rem; max-width: 500px; text-align: center; line-height: 1.6; }
  .visualizer {
    width: 100%;
    max-width: 720px;
    height: 80px;
    background: #12121a;
    border-radius: 8px;
    margin-bottom: 24px;
    overflow: hidden;
  }
  canvas { display: block; width: 100%; height: 100%; }
</style>
</head>
<body>

<h1>üéÆ Audio Test</h1>
<p class="subtitle">Colony Platformer ‚Äî Procedural Chiptune Engine</p>

<div class="visualizer">
  <canvas id="viz"></canvas>
</div>

<div class="grid">
  <button onclick="Audio.playJump()">
    <span class="emoji">‚¨ÜÔ∏è</span>
    Jump
    <span class="key">Press J</span>
  </button>
  <button onclick="Audio.playLand()">
    <span class="emoji">‚¨áÔ∏è</span>
    Land
    <span class="key">Press L</span>
  </button>
  <button onclick="Audio.playCollect()">
    <span class="emoji">ü™ô</span>
    Collect
    <span class="key">Press C</span>
  </button>
  <button onclick="Audio.playDeath()">
    <span class="emoji">üíÄ</span>
    Death
    <span class="key">Press D</span>
  </button>
  <button onclick="Audio.playPowerup()">
    <span class="emoji">‚≠ê</span>
    Powerup
    <span class="key">Press P</span>
  </button>
  <button onclick="Audio.playHurt()">
    <span class="emoji">üí•</span>
    Hurt
    <span class="key">Press H</span>
  </button>
  <button class="music-btn" id="music-btn" onclick="toggleMusic()">
    <span class="emoji">üéµ</span>
    <span id="music-label">Start Music</span>
    <span class="key">Press M</span>
  </button>
</div>

<div class="controls">
  <label>Master</label>
  <input type="range" min="0" max="100" value="50" oninput="Audio.setVolume(this.value/100)">
  <label>SFX</label>
  <input type="range" min="0" max="100" value="70" oninput="Audio.setSfxVolume(this.value/100)">
  <label>Music</label>
  <input type="range" min="0" max="100" value="30" oninput="Audio.setMusicVolume(this.value/100)">
</div>

<p class="hint">
  All sounds procedurally generated using the Web Audio API.<br>
  Zero external files. Zero loading. Just oscillators and noise.<br>
  Built by <a href="https://jeletor.com" style="color:#7b68ee">Jeletor</a> üåÄ for the Colony collaborative platformer.
</p>

<script src="js/audio.js"></script>
<script>
  // Init audio on first click
  document.addEventListener('click', () => Audio.init(), { once: true });
  document.addEventListener('keydown', () => Audio.init(), { once: true });

  function toggleMusic() {
    Audio.init();
    const btn = document.getElementById('music-btn');
    const label = document.getElementById('music-label');
    if (Audio.isMusicPlaying) {
      Audio.stopMusic();
      btn.classList.remove('playing');
      label.textContent = 'Start Music';
    } else {
      Audio.startMusic();
      btn.classList.add('playing');
      label.textContent = 'Stop Music';
    }
  }

  // Keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    Audio.init();
    switch(e.key.toLowerCase()) {
      case 'j': Audio.playJump(); break;
      case 'l': Audio.playLand(); break;
      case 'c': Audio.playCollect(); break;
      case 'd': Audio.playDeath(); break;
      case 'p': Audio.playPowerup(); break;
      case 'h': Audio.playHurt(); break;
      case 'm': toggleMusic(); break;
    }
  });

  // Simple waveform visualizer
  const canvas = document.getElementById('viz');
  const vizCtx = canvas.getContext('2d');

  function resizeCanvas() {
    canvas.width = canvas.offsetWidth * (window.devicePixelRatio || 1);
    canvas.height = canvas.offsetHeight * (window.devicePixelRatio || 1);
  }
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);

  let analyser = null;
  let dataArray = null;

  function setupVisualizer() {
    if (analyser || !Audio.initialized) return;
    try {
      const actx = new (window.AudioContext || window.webkitAudioContext)();
      // We can't easily tap into Audio's internal context, so we'll
      // use the destination's stream if available
      // Fallback: simple animation based on time
    } catch {}
  }

  // Animated bars (decorative ‚Äî syncs visually with music tempo)
  const bars = 48;
  const barValues = new Float32Array(bars);

  function animateViz() {
    const w = canvas.width;
    const h = canvas.height;
    vizCtx.clearRect(0, 0, w, h);

    const barWidth = w / bars;
    const time = performance.now() / 1000;

    for (let i = 0; i < bars; i++) {
      // Decay existing values
      barValues[i] *= 0.92;

      // If music is playing, add energy
      if (Audio.isMusicPlaying) {
        const beat = (time * (140/60)) % 4; // synced to BPM
        const onBeat = beat % 1 < 0.15;
        if (onBeat && Math.random() < 0.3) {
          barValues[i] = Math.max(barValues[i], 0.3 + Math.random() * 0.7);
        }
        // Bass frequencies on left, treble on right
        const freqBias = i / bars;
        if (Math.random() < 0.05) {
          barValues[i] = Math.max(barValues[i], (1 - freqBias) * 0.4 * Math.random());
        }
      }

      const barH = barValues[i] * h * 0.8;
      const x = i * barWidth + 1;
      const y = h - barH;

      const hue = 240 + (i / bars) * 60; // purple to blue
      vizCtx.fillStyle = `hsla(${hue}, 70%, 60%, ${0.3 + barValues[i] * 0.7})`;
      vizCtx.fillRect(x, y, barWidth - 2, barH);
    }

    requestAnimationFrame(animateViz);
  }
  animateViz();
</script>
</body>
</html>
